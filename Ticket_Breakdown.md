# Ticket Breakdown
We are a staffing company whose primary purpose is to book Agents at Shifts posted by Facilities on our platform. We're working on a new feature which will generate reports for our client Facilities containing info on how many hours each Agent worked in a given quarter by summing up every Shift they worked. Currently, this is how the process works:

- Data is saved in the database in the Facilities, Agents, and Shifts tables
- A function `getShiftsByFacility` is called with the Facility's id, returning all Shifts worked that quarter, including some metadata about the Agent assigned to each
- A function `generateReport` is then called with the list of Shifts. It converts them into a PDF which can be submitted by the Facility for compliance.

## You've been asked to work on a ticket. It reads:

**Currently, the id of each Agent on the reports we generate is their internal database id. We'd like to add the ability for Facilities to save their own custom ids for each Agent they work with and use that id when generating reports for them.**


Based on the information given, break this ticket down into 2-5 individual tickets to perform. Provide as much detail for each ticket as you can, including acceptance criteria, time/effort estimates, and implementation details. Feel free to make informed guesses about any unknown details - you can't guess "wrong".


You will be graded on the level of detail in each ticket, the clarity of the execution plan within and between tickets, and the intelligibility of your language. You don't need to be a native English speaker, but please proofread your work.

## Your Breakdown Here
- I am assuming the Main Ticket to be TICK-001 which is acting as the parent ticket to all my sub-tickets (TICK-001X)
- Using Time as days, not using the standard Fibonacci sequence 
- Intentionally going via the new table way, not the new column way (As I am not aware of the existing DB structure)
- A one-day time effort is kept in the main ticket, mainly for the interaction between the people for the collaboration of tasks.
- Assuming UUID is used primary key.

### Ticket 1 (TICK-0011)
Database Changes

#### Summary 
As we need to store the custom agent id which is generated by the Facilities for their reference in our database, we need to add one more table.

#### Implementation details
1. Create a table containing the following fields and constraints
   1. Internal Agent Id (UUID) (NOT NULL)
   2. Facility Id (UUID) (NOT NULL)
   3. Custom Agent Id (UUID) (NOT NULL) (By default blank)
   4. Unique Constraint ( Internal Agent Id, Facility Id)
   5. Unique Constraint ( Facility Id, Custom Agent Id) - Avoid the same Agent ID set by Facility

2. Make Proper migration files with rollback queries
3. Check for normalization of the database
4. Indexes on the Facility Id, Custom Agent Id (Collaborate with the API Eng. to add more indexes or change any)
5. Test the Changes first on staging and then on production

#### Acceptance Criteria:
1. Proper SQL file present in the repo, following the above points


#### Time / Effort
2 days 

### Ticket 2 (TICK-0012)
API addition

#### Summary
Add new endpoints to add or update the Custom Agent Id for a particular Agent to the facility.

#### Implementation Details
1. Prepare the API contract before starting the API Implementation
2. Create Proper API Routes for the Add or Update Logic

#### Acceptance Criteria:
1. Proper API documentation in the Postman along with examples
2. Proper Implemented API Routes in the REST fashion
3. Unit Test cases for the service layer
4. Integrations Test cases for the API layer
5. Test the changes first on staging (get is passed through QA also) and then production.

#### Time / Effort
2 days 


### Ticket 3 (TICK-0013)
Frontend Screens

#### Summary
Add a new screen to Add or update the Custom Agent ID for a particular Agent to the facility. 

#### Implementation Details
1. Prepare a response UI as per the screens provided by the UI/UX designer attached to the ticket
2. Use the API contract to start the development.

#### Acceptance Criteria:
1. Full responsive UI, working functionally with the actual APIs
2. Unit Test cases for the logic layer
3. Integrations Test cases for the complete workflow testing.
4. Test the changes on staging (get it to pass through QA also) and then production

#### Files:
1. UI files

#### Time / Effort
2 days

### Ticket 4 (TICK-0014)
Changes in the existing Report Generation mechanism

#### Summary
The existing Report generation mechanism relies on the internal agent id. Still, since we are moving to a custom agent id, we will allow the function to handle the custom Agent id as well.

#### Implementation Details
1. Make necessary changes in the getShiftsByFacility and generateReport to handle the custom agent Id. Handle the case in which custom agent id is missing by using the internal agent id)
2. Update API documentation in the Postman.
3. Update Unit Test cases for the service layer
4. Update Integrations Test cases for the API layer
5. Test the changes first on staging (get is passed through QA also) and then production

#### Acceptance Criteria:
1. Proper API documentation in the Postman along with examples.
2. Changes in the  API will not break the Existing Implementation (Important!!!)
3. Unit Test cases are passing successfully
4. Integrations Test cases passing successfully
5. Test the changes first on staging (get is passed through QA also) and then production

#### Time / Effort
3 days
